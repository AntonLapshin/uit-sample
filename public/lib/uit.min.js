!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(t.uit=t.uit||{})}(this,function(t){"use strict";function n(t,n){var e=this,i=t.split("."),r=i.pop(),o=void 0;i.shift(),this.on("set",function(t){e.olddata&&(o=s(e.olddata,i),h(o,r,n)),o=s(t,i),f(o,r,n)})}function e(){var t=this;this.els&&0!==this.els.length&&Array.prototype.filter.call(this.els,function(t){return t.matches("["+p.DATA_BIND_ATTRIBUTE+"]")}).forEach(function(n){var e=n.getAttribute(p.DATA_BIND_ATTRIBUTE);e&&e.split(",").forEach(function(e){var i=e.split(":"),r=i[0].trim(),o=i[1].trim();if(!d[r])throw new Error("binding rule <"+r+"> doesn't exist");d[r].call(t,n,o,e)})})}function i(t,n,e){var i=e?" "+p.DATA_CALL_ATTRIBUTE+'="'+e+'"':"",r="<div "+p.DATA_NAME_ATTRIBUTE+'="'+n+'"'+i+"></div>";return B(t,n,r)}var r=function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")},o=function(){function t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}}(),a=function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(t,n):t.__proto__=n)},c=function(t,n){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?t:n},u=0,l=function(){function t(){r(this,t),this.handlers={}}return o(t,[{key:"on",value:function(t,n){this.handlers.hasOwnProperty(t)||(this.handlers[t]=[]);var e=u++;return this.handlers[t].push({token:e,handler:n}),e}},{key:"fire",value:function(t,n,e){return!!this.handlers.hasOwnProperty(t)&&(this.handlers[t].forEach(function(t){return t.handler(n,e)}),!0)}},{key:"off",value:function(t){var n=this;for(var e in this.handlers)!function(e){var i=n.handlers[e];i.forEach(function(n,e){if(n.token===t)return i.splice(e,1),!0})}(e);return!1}},{key:"once",value:function(t,n){var e=this,i=this.on(t,function(t){n(t),e.off(i)})}}]),t}(),s=function t(n,e){return 0===e.length?n:(n=n[e[0]],e.shift(),t(n,e))},f=function(t,n,e){t.on&&t.on(n,e),e(t[n])},h=function(t,n,e){t.off&&t.off(e)},d={attr:function(t,e,i){var r=i.split(":")[2].trim();n.call(this,e,function(n){!1===n?t.removeAttribute(r):t.setAttribute(r,n)})},prop:function(t,e,i){var r=i.split(":")[2].trim();n.call(this,e,function(n){t[r]=n})},class:function(t,e,i){var r=i.split(":")[2].trim();n.call(this,e,function(n){t.classList.toggle(r,n)})},src:function(t,n){d.attr.call(this,t,n,"attr: "+n+": src")},href:function(t,n){d.attr.call(this,t,n,"attr: "+n+": href")},text:function(t,n){d.prop.call(this,t,n,"prop: "+n+": textContent")},val:function(t,n){d.prop.call(this,t,n,"prop: "+n+": value")},html:function(t,n){d.prop.call(this,t,n,"prop: "+n+": innerHTML")},visible:function(t,e){n.call(this,e,function(n){t.style.display=n?"":"none"})},invisible:function(t,e){n.call(this,e,function(n){t.style.display=n?"none":""})},enable:function(t,e){n.call(this,e,function(n){t.classList.toggle("disabled",!n)})},disable:function(t,n){d.class.call(this,t,n,"class: "+n+": disabled")},click:function(t,n){var e=this;t.addEventListener("click",function(){return e[n].call(e,t),!1})},ref:function(t,n){this[n]=t}},p={DATA_NAME_ATTRIBUTE:"data-uit-name",DATA_READY_ATTRIBUTE:"data-uit-ready",DATA_PATH_ATTRIBUTE:"data-uit-path",DATA_CALL_ATTRIBUTE:"data-uit-call",DATA_BIND_ATTRIBUTE:"data-bind",CALL_BY_INDEX:"byIndex",BASE_URL:"components/"},A=function(t){function n(t,i,o,a){r(this,n);var u=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return u.name=t,u.path=i,u.el=o,u.els=o.querySelectorAll("*:not(["+p.DATA_NAME_ATTRIBUTE+"])"),u.children={},a&&a(u),e.call(u),u}return a(n,t),o(n,[{key:"set",value:function(t){return this.olddata=this.data,this.data=t,this.fire("set",t,this.olddata),this}},{key:"load",value:function(){return this.fire("load"),this}},{key:"show",value:function(){return this.el.style.display="",this.fire("show"),this}},{key:"hide",value:function(){return this.el.style.display="none",this.fire("hide"),this}},{key:"test",value:function(){return this.el.style.display="",this.fire("test"),this}}]),n}(l),T=[{load:function(t,n){var e=new Image;e.onload=function(){n(e)},e.src=t},ext:/\b(png|jpg|gif)\b/},{load:function(t,n){var e=document.createElement("link");e.rel="stylesheet",e.href=t,document.head.appendChild(e),n(e)},ext:/\b(css)\b/},{load:function(t,n){var e=document.createElement("script");e.type="text/javascript",e.onload=function(){n(e)},e.src=t,document.getElementsByTagName("head")[0].appendChild(e)},ext:/\b(js)\b/},{load:function(t,n){var e=new XMLHttpRequest;e.open("GET",t,!0),e.onreadystatechange=function(){4===e.readyState&&e.responseText.length>0&&n(e.responseText)},e.send()},ext:/\b(html)\b/}],v=function(t){var n=t.split(".").pop(),e=T.find(function(t){return t.ext.test(n)});return new Promise(function(i){if(!e)throw"Loader for <"+n+"> files has not been implemented";e.cache||(e.cache={}),e.load(t,function(n){e.cache[t]=n,i(n)}),setTimeout(function(){e.cache[t]||(e.cache[t]=!0,i(!0))},3e3)})},y=function(t,n){return t+"+"+n},_=function(t,n){for(;(t=t.parentElement)&&!t.matches(n););return t},m=function(t,n,e,i){var r=y(n,e);if(t){var o=w[n];i===p.CALL_BY_INDEX?(o.children[e]||(o.children[e]=[]),r+="["+o.children[e].length+"]"):"string"==typeof i&&(o.children[e]||(o.children[e]={}),r+="["+i+"]")}return r},E=function(t,n,e,i,r){if(t){var o=w[e];i===p.CALL_BY_INDEX?o.children[n].push(r):i?o.children[n][i]=r:o.children[n]=r,r.parent=o}},b={},w={},g=function(t){return new Promise(function(n){var e=t.getAttribute(p.DATA_NAME_ATTRIBUTE),i=b[e];if(!i.view)throw"View of "+e+" component is undefined";var r=_(t,"["+p.DATA_NAME_ATTRIBUTE+"]"),o=r?r.getAttribute(p.DATA_PATH_ATTRIBUTE):"root",a=t.getAttribute(p.DATA_CALL_ATTRIBUTE),c=m(r,o,e,a);t.classList.add("_"+e),t.setAttribute(p.DATA_READY_ATTRIBUTE,!0),t.setAttribute(p.DATA_PATH_ATTRIBUTE,c),t.innerHTML=i.view;var u=new A(e,c,t,i.logic);w[c]=u,E(r,e,o,a,u),D(t).then(function(){u.load(),n(u)})})},D=function(t){var n=t.querySelectorAll("["+p.DATA_NAME_ATTRIBUTE+"]:not(["+p.DATA_READY_ATTRIBUTE+"]"),e=Array.prototype.map.call(n,function(t){return g(t)});return Promise.all(e).then(function(t){return t[0]})},B=function(t,n,e){if(t instanceof Element!=!0)throw"el is not an Element instance";return R(n).then(function(){var n=document.createElement("div");n.innerHTML=e;var i=n.firstChild;return t.appendChild(i),D(t)})},I=function(t,n){var e=n.map(function(t){if(-1===t.indexOf("."))return R(t);var n=p.BASE_URL+t;return v(n)});return Promise.all(e)},R=function(t){return b[t]?b[t].promise:new Promise(function(n){L.on(t+".load",function(t){n(t)}),I(t,[t+".js"])})},L=new l;t.event=L,t.define=function(){for(var t=arguments.length,n=Array(t),e=0;e<t;e++)n[e]=arguments[e];var i=n[0],r="string"==typeof n[1]?n[1]:null,o="string"==typeof n[2]?n[2]:null;if(o){var a=document.createElement("style");a.innerHTML=o,document.head.appendChild(a)}var c=r&&o?3:r||o?2:1,u=n[c]&&n[c].constructor===Array&&n[c];u?c++:u=[];var l=n[c]&&"function"==typeof n[c]&&n[c],s={name:i,view:r,deps:null};b[i]=s,s.promise=new Promise(function(t){I(i,u).then(function(n){r||(s.view=n[0]),s.deps=n,l&&(s.logic=function(t){l.call(t,t,s.deps),s.test&&t.on("test",function(){s.test(t)})}),L.fire(i+".load",s),t(s)})})},t.test=function(t,n){b[t].test=n},t.append=i,t.run=function(t,n){return n=n||(window.location.search.length>0?window.location.search.substring(1):null),i(t,n).then(function(t){return window.uitDebug?window.uitDebug.debug(t):t})},t.load=v,Object.defineProperty(t,"__esModule",{value:!0})});
