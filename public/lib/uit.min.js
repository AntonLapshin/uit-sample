!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.uit=t.uit||{})}(this,function(t){"use strict";function e(t,e){var n=this,i=void 0,r=t.split(".");"data"!==r[0]?(i=y(this,[].concat(u(r))),b(i,e)):(r.shift(),this.on("set",function(t){n.olddata&&(i=y(n.olddata,[].concat(u(r))),m(i,e)),i=y(t,[].concat(u(r))),b(i,e)}))}function n(){var t=this;this.elAll&&0!==this.elAll.length&&Array.prototype.filter.call(this.elAll,function(t){return d(t,"["+B.DATA_BIND_ATTRIBUTE+"]")}).forEach(function(e){var n=e.getAttribute(B.DATA_BIND_ATTRIBUTE);n&&n.split(",").forEach(function(n){var i=n.split(":"),r=i[0].trim(),o=i[1].trim();g[r]&&g[r].call(t,e,o,n)})})}function i(t,e){return k(t,e,"<div "+B.DATA_BLOCK_NAME_ATTRIBUTE+'="'+e+'"></div>')}var r=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},c=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},l=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},u=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},s=0,f=function(){function t(){r(this,t),this.handlers={}}return o(t,[{key:"on",value:function(t,e){this.handlers.hasOwnProperty(t)||(this.handlers[t]=[]);var n=s++;return this.handlers[t].push({token:n,handler:e}),n}},{key:"fire",value:function(t,e,n){return!!this.handlers.hasOwnProperty(t)&&(this.handlers[t].forEach(function(t){return t.handler(e,n)}),!0)}},{key:"off",value:function(t){var e=this;for(var n in this.handlers)!function(n){var i=e.handlers[n];i.forEach(function(e,n){if(e.token===t)return i.splice(n,1),!0})}(n);return!1}},{key:"once",value:function(t,e){var n=this,i=this.on(t,function(t){e(t),n.off(i)})}}]),t}(),h=function(t,e){return(t?t+"+":"")+e},d=function(t,e){return(t.matches||t.matchesSelector||t.msMatchesSelector||t.mozMatchesSelector||t.webkitMatchesSelector||t.oMatchesSelector).call(t,e)},p=function(t,e){for(;(t=t.parentElement)&&!d(t,e););return t},A={},T={},_=function(t){return new Promise(function(e){var n=t.getAttribute(B.DATA_BLOCK_NAME_ATTRIBUTE),i=A[n];if(!i.view)throw"View of "+n+" block is undefined";var r=p(t,"["+B.DATA_BLOCK_NAME_ATTRIBUTE+"]"),o=r?r.getAttribute(B.DATA_BLOCK_PATH_ATTRIBUTE):"root",a=t.getAttribute(B.DATA_BLOCK_CALL_ATTRIBUTE),c=h(o,n);if(r){var l=T[o];a===B.CALL_BY_INDEX?(l.children[n]||(l.children[n]=[]),c+="["+l.children[n].length+"]"):"string"==typeof a&&(l.children[n]||(l.children[n]={}),c+="["+a+"]")}t.classList.add("_"+n),t.setAttribute(B.DATA_BLOCK_READY_ATTRIBUTE,!0),t.setAttribute(B.DATA_BLOCK_PATH_ATTRIBUTE,c),t.innerHTML=i.view;var u=new w(n,c,t,i.logic);if(T[c]=u,r&&o){var s=T[o];a===B.CALL_BY_INDEX?s.children[n].push(u):a?s.children[n][a]=u:s.children[n]=u,u.parent=s}v(t).then(function(){u.load(),e(u)})})},v=function(t){var e=t.querySelectorAll("["+B.DATA_BLOCK_NAME_ATTRIBUTE+"]:not(["+B.DATA_BLOCK_READY_ATTRIBUTE+"]")||[],n=Array.prototype.map.call(e,function(t){return _(t)});return Promise.all(n).then(function(t){return t[0]})},y=function t(e,n){return 0===n.length?e:(e=e[n[0]],n.shift(),t(e,n))},b=function(t,e){t.on?(t.on(e),e(t())):e(t)},m=function(t,e){t.off&&t.off(e)},E=function(t){return null==t?t:t.on?t():t},g={src:function(t,n){e.call(this,n,function(e){t.setAttribute("src",E(e))})},text:function(t,n){e.call(this,n,function(e){t.textContent=E(e)})},class:function(t,n,i){var r=i.split(":")[2].trim();e.call(this,n,function(e){t.classList.toggle(r,E(e))})},attr:function(t,n,i){var r=i.split(":")[2].trim();e.call(this,n,function(e){t.setAttribute(r,E(e))})},href:function(t,n){e.call(this,n,function(e){t.setAttribute("href",E(e))})},val:function(t,n){e.call(this,n,function(e){t.value=E(e)})},html:function(t,n){e.call(this,n,function(e){t.innerHTML=E(e)})},visible:function(t,n){e.call(this,n,function(e){t.style.display=E(e)?"":"none"})},invisible:function(t,n){e.call(this,n,function(e){t.style.display=E(e)?"none":""})},enable:function(t,n){e.call(this,n,function(e){t.classList.toggle("disabled",!E(e))})},disable:function(t,n){e.call(this,n,function(e){t.classList.toggle("disabled",E(e))})},click:function(t,e){var n=this;t.addEventListener("click",function(){return n[e].call(n,t),!1})},prop:function(t,e){this[e]=t}},B={DATA_BLOCK_NAME_ATTRIBUTE:"data-block-name",DATA_BLOCK_READY_ATTRIBUTE:"data-block-ready",DATA_BLOCK_PATH_ATTRIBUTE:"data-block-path",DATA_BLOCK_CALL_ATTRIBUTE:"data-block-call",DATA_BIND_ATTRIBUTE:"data-bind",CALL_BY_INDEX:"byIndex",BASE_URL:"./blocks/"},w=function(t){function e(t,i,o,a){r(this,e);var c=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return c.name=t,c.path=i,c.el=o,c.elAll=o.querySelectorAll("*:not(["+B.DATA_BLOCK_NAME_ATTRIBUTE+"])"),c.children={},a(c),n.call(c),c}return c(e,t),o(e,[{key:"set",value:function(t){return this.olddata=this.data,this.data=t,this.fire("set",t,this.olddata),this}},{key:"load",value:function(){return this.fire("load"),this}},{key:"show",value:function(){return this.el.style.display="",this.fire("show"),this}},{key:"hide",value:function(){return this.el.style.display="none",this.fire("hide"),this}},{key:"test",value:function(){return this.el.style.display="",this.fire("test"),this}}]),e}(f),O=[{load:function(t,e){var n=new Image;n.onload=function(){e(n)},n.src=t},ext:/\b(png|jpg|gif)\b/},{load:function(t,e){var n=document.createElement("link");n.rel="stylesheet",n.href=t,document.head.appendChild(n),e(n)},ext:/\b(css)\b/},{load:function(t,e){var n=document.createElement("script");n.type="text/javascript",n.onload=function(){e(n)},n.src=t,document.getElementsByTagName("head")[0].appendChild(n)},ext:/\b(js)\b/},{load:function(t,e){var n=new XMLHttpRequest;n.open("GET",t,!0),n.onreadystatechange=function(){4===n.readyState&&n.responseText.length>0&&e(n.responseText)},n.send()},ext:/\b(html)\b/}],L=function(t){var e=t.split(".").pop(),n=O.find(function(t){return t.ext.test(e)});return new Promise(function(i){if(!n)throw"Loader for <"+e+"> files has not been implemented";n.cache||(n.cache={}),n.load(t,function(e){n.cache[t]=e,i(e)}),setTimeout(function(){n.cache[t]||(n.cache[t]=!0,i(!0))},3e3)})},D=function(t){function e(t){r(this,e);var n=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.data=t,n}return c(e,t),o(e,[{key:"update",value:function(t){return this.olddata=this.data,this.data=t,this.fire()}},{key:"fire",value:function(){return a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"fire",this).call(this,"update",this.data,this.olddata)}},{key:"on",value:function(t){return a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"on",this).call(this,"update",t)}}]),e}(f),k=function(t,e,n){if(t instanceof Element!=!0)throw"el is not an Element instance";return I(e).then(function(){var e=document.createElement("div");e.innerHTML=n;var i=e.firstChild;return t.appendChild(i),v(t)})},C=function(t,e){var n=B.BASE_URL+t+"/",i=e.map(function(t){return-1===t.indexOf(".")?I(t):L(n+t)});return Promise.all(i)},I=function(t){return A[t]?A[t].promise:new Promise(function(e){R.on(t+".load",function(t){e(t)}),C(t,["logic.js"])})},R=new f;t.event=R,t.define=function(t,e,n){var i={name:t,deps:null};A[t]=i,i.promise=new Promise(function(r){C(t,["view.html","style.css"].concat(u(e))).then(function(e){i.view=e[0],i.deps=e,i.logic=function(t){n.call(t,t,i.deps)},R.fire(t+".load",i),r(i)})})},t.append=i,t.run=function(t){var e=window.location.search;return i(t,e.length>0?e.substring(1):null).then(function(t){return window.uitDebug?window.uitDebug.debug(t):t})},t.load=L,t.Observable=function(t){var e=new D(t),n=function t(n){return void 0===n?e.data:(e.update(n),t)};return n.on=function(t){return e.on(t)},n.off=function(t){return e.off(t)},n},Object.defineProperty(t,"__esModule",{value:!0})});
