!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(t.uit=t.uit||{})}(this,function(t){"use strict";function n(t,n){var e=this,i=t.split("."),r=i.pop(),o=void 0;i.shift(),this.on("set",function(t){e.olddata&&(o=f(e.olddata,i),d(o,r,n)),o=f(t,i),h(o,r,n)})}function e(){var t=this;this.elAll&&0!==this.elAll.length&&Array.prototype.filter.call(this.elAll,function(t){return t.matches("["+A.DATA_BIND_ATTRIBUTE+"]")}).forEach(function(n){var e=n.getAttribute(A.DATA_BIND_ATTRIBUTE);e&&e.split(",").forEach(function(e){var i=e.split(":"),r=i[0].trim(),o=i[1].trim();if(!p[r])throw new Error("binding rule <"+r+"> doesn't exist");p[r].call(t,n,o,e)})})}function i(t,n){return I(t,n,"<div "+A.DATA_NAME_ATTRIBUTE+'="'+n+'"></div>')}var r=function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")},o=function(){function t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}}(),a=function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(t,n):t.__proto__=n)},l=function(t,n){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?t:n},c=function(t){if(Array.isArray(t)){for(var n=0,e=Array(t.length);n<t.length;n++)e[n]=t[n];return e}return Array.from(t)},u=0,s=function(){function t(){r(this,t),this.handlers={}}return o(t,[{key:"on",value:function(t,n){this.handlers.hasOwnProperty(t)||(this.handlers[t]=[]);var e=u++;return this.handlers[t].push({token:e,handler:n}),e}},{key:"fire",value:function(t,n,e){return!!this.handlers.hasOwnProperty(t)&&(this.handlers[t].forEach(function(t){return t.handler(n,e)}),!0)}},{key:"off",value:function(t){var n=this;for(var e in this.handlers)!function(e){var i=n.handlers[e];i.forEach(function(n,e){if(n.token===t)return i.splice(e,1),!0})}(e);return!1}},{key:"once",value:function(t,n){var e=this,i=this.on(t,function(t){n(t),e.off(i)})}}]),t}(),f=function t(n,e){return 0===e.length?n:(n=n[e[0]],e.shift(),t(n,e))},h=function(t,n,e){t.on&&t.on(n,e),e(t[n])},d=function(t,n,e){t.off&&t.off(e)},p={attr:function(t,e,i){var r=i.split(":")[2].trim();n.call(this,e,function(n){t.setAttribute(r,n)})},prop:function(t,e,i){var r=i.split(":")[2].trim();n.call(this,e,function(n){t[r]=n})},class:function(t,e,i){var r=i.split(":")[2].trim();n.call(this,e,function(n){t.classList.toggle(r,n)})},src:function(t,n){p.attr.call(this,t,n,"attr: "+n+": src")},href:function(t,n){p.attr.call(this,t,n,"attr: "+n+": href")},text:function(t,n){p.prop.call(this,t,n,"prop: "+n+": textContent")},val:function(t,n){p.prop.call(this,t,n,"prop: "+n+": value")},html:function(t,n){p.prop.call(this,t,n,"prop: "+n+": innerHTML")},visible:function(t,e){n.call(this,e,function(n){t.style.display=n?"":"none"})},invisible:function(t,e){n.call(this,e,function(n){t.style.display=n?"none":""})},enable:function(t,e){n.call(this,e,function(n){t.classList.toggle("disabled",!n)})},disable:function(t,n){p.class.call(this,t,n,"class: "+n+": disabled")},click:function(t,n){var e=this;t.addEventListener("click",function(){return e[n].call(e,t),!1})},ref:function(t,n){this[n]=t}},A={DATA_NAME_ATTRIBUTE:"data-uit-name",DATA_READY_ATTRIBUTE:"data-uit-ready",DATA_PATH_ATTRIBUTE:"data-uit-path",DATA_CALL_ATTRIBUTE:"data-uit-call",DATA_BIND_ATTRIBUTE:"data-bind",CALL_BY_INDEX:"byIndex",BASE_URL:"./components/"},T=function(t){function n(t,i,o,a){r(this,n);var c=l(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return c.name=t,c.path=i,c.el=o,c.elAll=o.querySelectorAll("*:not(["+A.DATA_NAME_ATTRIBUTE+"])"),c.children={},a&&a(c),e.call(c),c}return a(n,t),o(n,[{key:"set",value:function(t){return this.olddata=this.data,this.data=t,this.fire("set",t,this.olddata),this}},{key:"load",value:function(){return this.fire("load"),this}},{key:"show",value:function(){return this.el.style.display="",this.fire("show"),this}},{key:"hide",value:function(){return this.el.style.display="none",this.fire("hide"),this}},{key:"test",value:function(){return this.el.style.display="",this.fire("test"),this}}]),n}(s),v=[{load:function(t,n){var e=new Image;e.onload=function(){n(e)},e.src=t},ext:/\b(png|jpg|gif)\b/},{load:function(t,n){var e=document.createElement("link");e.rel="stylesheet",e.href=t,document.head.appendChild(e),n(e)},ext:/\b(css)\b/},{load:function(t,n){var e=document.createElement("script");e.type="text/javascript",e.onload=function(){n(e)},e.src=t,document.getElementsByTagName("head")[0].appendChild(e)},ext:/\b(js)\b/},{load:function(t,n){var e=new XMLHttpRequest;e.open("GET",t,!0),e.onreadystatechange=function(){4===e.readyState&&e.responseText.length>0&&n(e.responseText)},e.send()},ext:/\b(html)\b/}],y=function(t){var n=t.split(".").pop(),e=v.find(function(t){return t.ext.test(n)});return new Promise(function(i){if(!e)throw"Loader for <"+n+"> files has not been implemented";e.cache||(e.cache={}),e.load(t,function(n){e.cache[t]=n,i(n)}),setTimeout(function(){e.cache[t]||(e.cache[t]=!0,i(!0))},3e3)})},_=function(t,n){return t+"+"+n},m=function(t,n){for(;(t=t.parentElement)&&!t.matches(n););return t},E=function(t,n,e,i){var r=_(n,e);if(t){var o=g[n];i===A.CALL_BY_INDEX?(o.children[e]||(o.children[e]=[]),r+="["+o.children[e].length+"]"):"string"==typeof i&&(o.children[e]||(o.children[e]={}),r+="["+i+"]")}return r},b=function(t,n,e,i,r){if(t){var o=g[e];i===A.CALL_BY_INDEX?o.children[n].push(r):i?o.children[n][i]=r:o.children[n]=r,r.parent=o}},w={},g={},D=function(t){return new Promise(function(n){var e=t.getAttribute(A.DATA_NAME_ATTRIBUTE),i=w[e];if(!i.view)throw"View of "+e+" component is undefined";var r=m(t,"["+A.DATA_NAME_ATTRIBUTE+"]"),o=r?r.getAttribute(A.DATA_PATH_ATTRIBUTE):"root",a=t.getAttribute(A.DATA_CALL_ATTRIBUTE),l=E(r,o,e,a);t.classList.add("_"+e),t.setAttribute(A.DATA_READY_ATTRIBUTE,!0),t.setAttribute(A.DATA_PATH_ATTRIBUTE,l),t.innerHTML=i.view;var c=new T(e,l,t,i.logic);g[l]=c,b(r,e,o,a,c),B(t).then(function(){c.load(),n(c)})})},B=function(t){var n=t.querySelectorAll("["+A.DATA_NAME_ATTRIBUTE+"]:not(["+A.DATA_READY_ATTRIBUTE+"]"),e=Array.prototype.map.call(n,function(t){return D(t)});return Promise.all(e).then(function(t){return t[0]})},I=function(t,n,e){if(t instanceof Element!=!0)throw"el is not an Element instance";return L(n).then(function(){var n=document.createElement("div");n.innerHTML=e;var i=n.firstChild;return t.appendChild(i),B(t)})},R=function(t,n){var e=A.BASE_URL+t+"/",i=n.map(function(t){return-1===t.indexOf(".")?L(t):y(e+t)});return Promise.all(i)},L=function(t){return w[t]?w[t].promise:new Promise(function(n){U.on(t+".load",function(t){n(t)}),R(t,["logic.js"])})},U=new s;t.event=U,t.define=function(t,n,e){var i={name:t,deps:null};w[t]=i,i.promise=new Promise(function(r){R(t,["view.html","style.css"].concat(c(n))).then(function(n){i.view=n[0],i.deps=n,i.logic=function(t){e.call(t,t,i.deps)},U.fire(t+".load",i),r(i)})})},t.append=i,t.run=function(t){var n=window.location.search;return i(t,n.length>0?n.substring(1):null).then(function(t){return window.uitDebug?window.uitDebug.debug(t):t})},t.load=y,Object.defineProperty(t,"__esModule",{value:!0})});
